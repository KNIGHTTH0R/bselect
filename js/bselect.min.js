(function(e,t){"use strict";function i(e,i){return u[i]!==t?u[i].apply(e,Array.prototype.slice.call(arguments,2)):e}function s(t){return i(t,"option","placeholder")||t.data("placeholder")||e.bselect.i18n.selectAnOption}function n(e){var t=e.find(".bselect-option-list"),i=t.find("li:visible").length;t.innerHeight(1.5*parseInt(t.css("line-height"),10)*(5>i?i:5))}function a(t,s,n){var a=i(t,"element");e.each(s,function(t,i){if(n[t]!==i&&"size"===t){var s=e.map(p.slice(0),function(e){return"bselect-"+e}).join(" ");a.removeClass(s),p.indexOf(n.size)>-1&&a.addClass("bselect-"+n.size)}})}function l(t){var s=i(t,"element");s.find(".bselect-message").text(e.bselect.i18n.noOptionsAvailable).show()}function o(t){if(38===t.keyCode||40===t.keyCode||13===t.keyCode){var i=e(this),s=i.is(".bselect-search-input");switch(t.keyCode){case 38:s?e(t.delegateTarget).find(".bselect-option:visible:last").focus():i.prevAll(".bselect-option:visible").eq(0).focus();break;case 40:s?e(t.delegateTarget).find(".bselect-option:visible:first").focus():i.nextAll(".bselect-option:visible").eq(0).focus();break;case 13:s||i.trigger("click")}return!1}}function r(t,n){var l,r,p,b,f,v=e(t);if(b=++c,p=e("<div class='bselect' />",{id:"bselect-"+b}),f=e("<div class='bselect-dropdown' />"),n.searchInput===!0){var g=e("<div class='bselect-search' />");e("<input type='text' class='bselect-search-input' />").attr({role:"combobox",tabindex:1,"aria-expanded":"false","aria-owns":"bselect-option-list-"+b}).appendTo(g),e("<span class='bselect-search-icon'><i class='icon-search' /></span>").appendTo(g),g.appendTo(f)}e("<div class='bselect-message' role='status' />").appendTo(f),e("<ul class='bselect-option-list' />").attr({id:"bselect-option-list-"+b,role:"listbox"}).appendTo(f),p.append(f).insertAfter(v),v.data(d,{options:n,element:p,open:!1}),a(v,e.bselect.defaults,n),i(v,"refresh"),v.bind("bselectselect",n.select),v.bind("bselectselected",n.selected),v.bind("bselectsearch",n.search),r=e("<span />").addClass("bselect-label").text(s(v)),l=e("<button type='button' />").addClass("bselect-caret").html("<span class='caret'></span>"),p.prepend(l).prepend(r),r.outerWidth(v.outerWidth()-l.outerWidth()),v.addClass("bselect-inaccessible"),h.push(v),p.find(".bselect-search-input").keyup(e.proxy(u.search,v)),p.on("click",".bselect-option",e.proxy(u.select,v)),p.on("click",".bselect-caret, .bselect-label",e.proxy(u.toggle,v)),p.on("keydown",".bselect-option, .bselect-search-input",o),v.bind("change.bselect",function(){var e=v.data(d).itemsMap[this.value];i(v,"select",e)}).trigger("change.bselect"),t.id&&e(document).on("click","label[for='"+t.id+"']",function(){return i(v,"show"),!1})}var c=0,d="bselect",h=[],p=["mini","small","large"],u={option:function(i,s){var n=this.data(d).options||{},l=e.extend({},n);return"string"==typeof i&&"_"!==i[0]?s===t?n[i]:(n[i]=s,a(this,l,n),this):(e.isPlainObject(i)&&(e.extend(n,i),a(this,l,n),this.data(d).options=n),n)},element:function(){return this.data(d).element},toggle:function(t){if(this[0].disabled)return this;var s=i(this,"element");if(t instanceof e.Event){var n=i(this,"option","showOn");if(e(t.target).is(".bselect-label")&&"both"!==n)return this}return s.find(".bselect-dropdown").is(":hidden")?i(this,"show"):i(this,"hide"),this},show:function(){var t=this.data(d);if(this[0].disabled||t.open)return this;var s,a,l=t.element,o=l.find(".bselect-dropdown");if(o.css("left","-9999em").show(),n(l),a=l.find(".bselect-option.active"),a.length){var r=l.find(".bselect-option-list"),c=a.position().top,h=r.position().top;r.height()>c-h?r.scrollTop(0):r.scrollTop(c-h)}return o.hide().css("left","auto"),o.slideDown(i(this,"option","animationDuration")),this.data(d,e.extend(t,{open:!0})),l.addClass("open"),s=l.find(".bselect-search-input").focus(),s.innerWidth(s.parent().width()-s.next().outerWidth()),l.find(".bselect-search-input").attr("aria-expanded","true"),this},hide:function(s){var n=this.data(d);if(this[0].disabled||!n.open)return this;var a=n.options,l=n.element;return s=s===t?!0:s,this.data(d,e.extend(n,{open:!1})),l.find(".bselect-dropdown").slideUp(a.animationDuration),l.removeClass("open"),s&&a.clearSearchOnExit&&i(this,"clearSearch"),l.find(".bselect-search-input").attr("aria-expanded","false"),this},select:function(t){var s,n,a=i(this,"element");if(t instanceof e.Event)s=e(t.currentTarget);else if(s=a.find("li").eq(t),!s.length)return this;var l=a.find("li").removeClass("active").attr("aria-selected","false").index(s),o=this.find("option[value!='']").get(l);return this.trigger("bselectselect",[o]),n=s.addClass("active").data("value"),s.attr("aria-selected","true"),a.find(".bselect-label").text(s.text()),i(this,"hide"),this.val(n),this.trigger("bselectselected",[n,o]),this},search:function(t){if(this[0].disabled)return this;var s,a,o=i(this,"option"),r=t instanceof e.Event?t.target.value:t,c=i(this,"element");if(""===r&&i(this,"clearSearch"),t instanceof e.Event||c.find(".bselect-search").val(r),!(r===o.lastSearch||r.length<o.minSearchInput)){var d=e();for(s=c.find("li").hide(),a=0;s.length>a;a++)s[a].textContent.toLowerCase().indexOf(r.toLowerCase())>-1&&(d=d.add(e(s[a]).show()));return 0===d.length?l(this):c.find(".bselect-message").hide(),this.trigger("bselectsearch",[r,d]),n(s.end()),this}},clearSearch:function(){var e=i(this,"element");return e.find(".bselect-search-input").val(""),e.find("li").show(),e.find(".bselect-message").hide(),n(e),this},disable:function(){return this[0].disabled||(i(this,"element").addClass("disabled"),this.prop("disabled",!0)),this},enable:function(){return this[0].disabled&&(i(this,"element").removeClass("disabled"),this.prop("disabled",!1)),this},refresh:function(){var t=i(this,"element"),s=t.find(".bselect-option-list").empty(),n={},a=0;return t.toggleClass("disabled",this.prop("disabled")),this.find("option, > optgroup").each(function(){var t,i,l=e(this).is("option");(!l||this.value)&&(t=l?"bselect-option"+(e(this).closest("optgroup").length?" grouped":""):"bselect-option-group",i=e("<li />").attr({"class":t,role:"option",tabindex:l?2:-1,"aria-selected":"false"}),l?(i.data("value",this.value),n[this.value]=a,i.html("<a href='#'>"+this.text+"</a>")):i.text(this.label),i.appendTo(s),a++)}),0===a&&l(this),this.data(d).itemsMap=n,this},destroy:function(){var e=i(this,"element");return this.data(d,null),h.splice(h.indexOf(this),1),e.remove(),this.show(),this}};e.fn.bselect=function(i){return"string"==typeof i&&this[0]?e.isPlainObject(e(this[0]).data(d))&&u[i]!==t?u[i].apply(e(this[0]),Array.prototype.slice.call(arguments,1)):this:this.each(function(){e.isPlainObject(e(this).data(d))||(i=e.isPlainObject(i)?i:{},i=e.extend({},e.bselect.defaults,i),r(this,i))})},e.bselect={defaults:{size:"normal",showOn:"both",clearSearchOnExit:!0,minSearchInput:0,animationDuration:300,searchInput:!0,search:null,select:null,selected:null},i18n:{selectAnOption:"Select an option",noOptionsAvailable:"No options available."}},e(document).click(function(e){var t,s,n;for(t=0,s=h.length;s>t;t++)n=h[t].data(d),n.open&&!n.element.has(e.target).length&&i(h[t],"hide")}),e(window).resize(function(){var e,t,i,s;for(e=0,t=h.length;t>e;e++)i=h[e].data(d),s=i.element.find(".bselect-caret"),i.element.find(".bselect-label").outerWidth(h[e].outerWidth()-s.outerWidth())})})(jQuery);