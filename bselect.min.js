/*!
 * BSelect v0.2.3 - 2013-03-08
 * 
 * Created by Gustavo Henke <gustavo@injoin.com.br>
 * http://gustavohenke.github.com/bselect/
 */
(function(e,t){"use strict";function s(e,s){return c[s]!==t?c[s].apply(e,Array.prototype.slice.call(arguments,2)):e}function i(t){return s(t,"option","placeholder")||t.data("placeholder")||e.bselect.i18n.selectAnOption}function n(e){var t=e.find(".bselect-option-list"),s=t.find("li:visible").length;t.innerHeight(1.5*parseInt(t.css("line-height"),10)*(5>s?s:5))}function a(t,i,n){var a=s(t,"element");e.each(i,function(t,s){if(n[t]!==s&&"size"===t){var i;i=e.map(o.slice(0),function(e){return"bselect-"+e}).join(" "),a.removeClass(i),o.indexOf(n.size)>-1&&a.addClass("bselect-"+n.size)}})}function l(t,n){var l,o,d,h,p,u=e(t);if(h=++r,d=e("<div class='bselect' />",{id:"bselect-"+h}),p=e("<div class='bselect-dropdown' />"),n.searchInput===!0){var f=e("<div class='bselect-search' />");e("<input type='text' class='bselect-search-input' />").attr({role:"combobox","aria-expanded":"false","aria-owns":"bselect-option-list-"+h}).appendTo(f),e("<span class='bselect-search-icon'><i class='icon-search' /></span>").appendTo(f),f.appendTo(p)}e("<ul class='bselect-option-list' />").attr({id:"bselect-option-list-"+h,role:"listbox"}).appendTo(p),d.append(p).insertAfter(u),u.data("bselect",{options:n,element:d}),a(u,e.bselect.defaults,n),s(u,"refresh"),u.bind("bselectselect",n.select),u.bind("bselectselected",n.selected),u.bind("bselectsearch",n.search),o=e("<span />").addClass("bselect-label").text(i(u)),l=e("<button type='button' />").addClass("bselect-caret").html("<span class='caret'></span>"),d.prepend(l).prepend(o),o.outerWidth(u.outerWidth()-l.outerWidth()),u.hide(),e(document).click(function(t){d.find(".bselect-dropdown").is(":visible")&&!e(".bselect-dropdown, .bselect-dropdown *",d).find(t.target).length&&s(u,"hide")}),d.find(".bselect-search-input").keyup(e.proxy(c.search,u)),d.on("click",".bselect-option",e.proxy(c.select,u)),d.on("click",".bselect-caret, .bselect-label",e.proxy(c.toggle,u))}var r=0,c={option:function(s,i){var n=this.data("bselect").options||{},l=e.extend({},n);return"string"==typeof s&&"_"!==s[0]?i===t?n[s]:(n[s]=i,a(this,l,n),this):(e.isPlainObject(s)&&(e.extend(n,s),a(this,l,n),this.data("bselect").options=n),n)},element:function(){return this.data("bselect").element},toggle:function(t){var i=s(this,"element");if(t instanceof e.Event){var n=s(this,"option","showOn");if(t.stopPropagation(),e(t.target).is(".bselect-label")&&"both"!==n)return this}return i.find(".bselect-dropdown").is(":hidden")?s(this,"show"):s(this,"hide"),this},show:function(){var e,t=s(this,"element"),i=t.find(".bselect-dropdown");return i.css("left","-9999em").show(),n(t),i.hide().css("left","auto"),i.slideDown(s(this,"option","animationDuration")),t.addClass("open"),e=t.find(".bselect-search-input"),e.innerWidth(e.parent().width()-e.next().outerWidth()),t.find(".bselect-search-input").attr("aria-expanded","true"),this},hide:function(e){var i=s(this,"option"),n=s(this,"element");return e=e===t?!0:e,n.find(".bselect-dropdown").slideUp(i.animationDuration),n.removeClass("open"),e&&i.clearSearchOnExit&&s(this,"clearSearch"),n.find(".bselect-search-input").attr("aria-expanded","false"),this},select:function(t){var i,n,a=(s(this,"option"),s(this,"element"));if(t instanceof e.Event)i=e(t.currentTarget);else if(i=a.find("li").eq(t),!i.length)return this;var l=a.find("li").removeClass("active").attr("aria-selected","false").index(i),r=this.find("option[value!='']").get(l);return this.trigger("bselectselect",[r]),n=i.addClass("active").data("value"),i.attr("aria-selected","true"),a.find(".bselect-label").text(i.text()),s(this,"hide"),this.val(n),this.trigger("bselectselected",[n,r]),this},search:function(t){var i,a,l=s(this,"option"),r=t instanceof e.Event?t.target.value:t,c=s(this,"element");if(""===r&&s(this,"clearSearch"),t instanceof e.Event||c.find(".bselect-search").val(r),!(r===l.lastSearch||r.length<l.minSearchInput)){var o=e();for(i=c.find("li").hide(),a=0;i.length>a;a++)i[a].textContent.toLowerCase().indexOf(r.toLowerCase())>-1&&o.add(e(i[a]).show());return this.trigger("bselectsearch",[r,o]),n(i.end()),this}},clearSearch:function(){var e=s(this,"element");return e.find(".bselect-search").val(""),e.find("li").show(),n(e),this},refresh:function(){var t=s(this,"element"),i=t.find(".bselect-option-list").empty();return this.find("option").each(function(){if(this.value){var t=e("<li class='bselect-option' />").attr({role:"option","aria-selected":"false"}).data("value",this.value);t.append("<a href='#'>"+this.text+"</a>"),t.appendTo(i)}}),this},destroy:function(){var e=s(this,"element");this.data("bselect",null),e.remove(),this.show()}},o=["mini","small","large"];e.fn.bselect=function(s){return"string"==typeof s&&this[0]?e.isPlainObject(e(this[0]).data("bselect"))&&c[s]!==t?c[s].apply(e(this[0]),Array.prototype.slice.call(arguments,1)):this:this.each(function(){e.isPlainObject(e(this).data("bselect"))||(s=e.isPlainObject(s)?s:{},s=e.extend({},e.bselect.defaults,s),l(this,s))})},e.bselect={defaults:{size:"normal",showOn:"both",clearSearchOnExit:!0,minSearchInput:0,animationDuration:300,searchInput:!0,search:null,select:null,selected:null},i18n:{selectAnOption:"Select an option"}}})(jQuery);