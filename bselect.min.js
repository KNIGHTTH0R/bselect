/*!
 * BSelect v0.2.2 - 2013-03-04
 * 
 * Created by Gustavo Henke <gustavo@injoin.com.br>
 * http://gustavohenke.github.com/bselect/
 */
(function(e,t){"use strict";function n(e,n){return o[n]!==t?o[n].apply(e,Array.prototype.slice.call(arguments,2)):e}function i(t){return n(t,"option","placeholder")||t.data("placeholder")||e.bselect.i18n.selectAnOption}function s(e){var t=e.find(".bselect-option-list"),n=t.find("li:visible").length;t.innerHeight(1.5*parseInt(t.css("line-height"),10)*(5>n?n:5))}function l(t,i,s){var l=n(t,"element");e.each(i,function(t,n){if(s[t]!==n&&"size"===t){var i;i=e.map(r.slice(0),function(e){return"bselect-"+e}).join(" "),l.removeClass(i),r.indexOf(s.size)>-1&&l.addClass("bselect-"+s.size)}})}function a(t,s){var a,r,h,d,u=e(t);d="<div class='bselect' id='bselect-"+ ++c+"'>",d+="<div class='bselect-dropdown'>",s.searchInput===!0&&(d+="<div class='bselect-search'><input type='text' class='bselect-search-input' /><span class='bselect-search-icon'><i class='icon-search'></i></span></div>"),d+="<ul class='bselect-option-list'></ul>",d+="</div></div>",h=u.after(d).next(),u.data("bselect",{options:s,element:h}),l(u,e.bselect.defaults,s),n(u,"refresh"),r=e("<span />").addClass("bselect-label").text(i(u)),a=e("<button type='button' />").addClass("bselect-caret").html("<span class='caret'></span>"),h.prepend(a).prepend(r),r.outerWidth(u.outerWidth()-a.outerWidth()),u.hide(),e(document).click(function(t){h.find(".bselect-dropdown").is(":visible")&&!e(".bselect-dropdown, .bselect-dropdown *",h).find(t.target).length&&n(u,"hide")}),h.find(".bselect-search-input").keyup(e.proxy(o.search,u)),h.on("click",".bselect-option",e.proxy(o.select,u)),h.on("click",".bselect-caret, .bselect-label",e.proxy(o.toggle,u))}var c=0,o={option:function(n,i){var s=this.data("bselect").options||{},a=e.extend({},s);return"string"==typeof n&&"_"!==n[0]?i===t?s[n]:(s[n]=i,l(this,a,s),this):(e.isPlainObject(n)&&(e.extend(s,n),l(this,a,s),this.data("bselect").options=s),s)},element:function(){return this.data("bselect").element},toggle:function(t){var i=n(this,"element");if(t instanceof e.Event){var s=n(this,"option","showOn");if(t.stopPropagation(),e(t.target).is(".bselect-label")&&"both"!==s)return this}return i.find(".bselect-dropdown").is(":hidden")?n(this,"show"):n(this,"hide"),this},show:function(){var e,t=n(this,"element"),i=t.find(".bselect-dropdown");return i.css("left","-9999em").show(),s(t),i.hide().css("left","auto"),i.slideDown(n(this,"option","animationDuration")),t.addClass("open"),e=t.find(".bselect-search-input"),e.innerWidth(e.parent().width()-e.next().outerWidth()),this},hide:function(e){var i=n(this,"option"),s=n(this,"element");return e=e===t?!0:e,s.find(".bselect-dropdown").slideUp(i.animationDuration),s.removeClass("open"),e&&i.clearSearchOnExit&&n(this,"clearSearch"),this},select:function(t){var i,s,l=n(this,"option"),a=n(this,"element");if(t instanceof e.Event)i=e(t.currentTarget);else if(i=a.find("li").eq(t),!i.length)return this;return a.find("li").removeClass("active"),s=i.addClass("active").data("value"),a.find(".bselect-label").text(i.text()),n(this,"hide"),this.val(s),"function"==typeof l.selected&&l.selected.call(this,s,i),this},search:function(t){var i,l,a=n(this,"option"),c=t instanceof e.Event?t.target.value:t,o=n(this,"element");if(""===c&&n(this,"clearSearch"),t instanceof e.Event||o.find(".bselect-search").val(c),!(c===a.lastSearch||c.length<a.minSearchInput)){for(i=o.find("li").hide(),l=0;i.length>l;l++)i[l].textContent.toLowerCase().indexOf(c.toLowerCase())>-1&&e(i[l]).show();return s(i.end()),this}},clearSearch:function(){var e=n(this,"element");return e.find(".bselect-search").val(""),e.find("li").show(),s(e),this},refresh:function(){var e=n(this,"element"),t="";return this.find("option").each(function(){this.value&&(t+="<li class='bselect-option' data-value='"+this.value+"'>"+"<a href='#'>"+this.text+"</a>"+"</li>")}),e.find(".bselect-option-list").html(t),this},destroy:function(){var e=n(this,"element");this.data("bselect",null),e.remove(),this.show()}},r=["mini","small","large"];e.fn.bselect=function(n){return"string"==typeof n&&this[0]&&e.isPlainObject(e(this[0]).data("bselect"))&&o[n]!==t?o[n].apply(e(this[0]),Array.prototype.slice.call(arguments,1)):this.each(function(){n=e.isPlainObject(n)?n:{},n=e.extend({},e.bselect.defaults,n),a(this,n)})},e.bselect={defaults:{size:"normal",showOn:"both",clearSearchOnExit:!0,minSearchInput:0,animationDuration:300,searchInput:!0,select:null,selected:null},i18n:{selectAnOption:"Select an option"}}})(jQuery);